<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>円をクリックして得点を上げるゲーム</title>
    <style>
    </style>
</head>
<body>
    <div id="startScreen">
        <h1>円クリックゲーム</h1>
        <p>スペースキーを押してスタート!</p>
    </div>
    <div id="score">スコア: 0</div>
    <div id="timer">タイマー: 1.00秒</div> <!-- タイマー表示 -->
    <div id="gameArea">
        <div id="circle"></div>
    </div>
    <div id="gameOver">ゲームオーバー!</div> <!-- ゲームオーバーメッセージ -->
    <div id="finalScore" style="display: none; font-size: 24px; margin-top: 20px;">最終スコア: 0</div> <!-- 最終スコア -->
    <button id="continueButton" onclick="continueGame()">コンティニュー</button> <!-- コンティニューボタン -->

    <script>
        let score = 0; // スコア初期化
        const scoreDisplay = document.getElementById('score');
        const timerDisplay = document.getElementById('timer');
        const circle = document.getElementById('circle');
        const gameArea = document.getElementById('gameArea');
        const gameOverDisplay = document.getElementById('gameOver');
        const continueButton = document.getElementById('continueButton');
        const finalScoreDisplay = document.getElementById('finalScore'); // 最終スコア表示用
        const startScreen = document.getElementById('startScreen');

        let timer; // タイマーのID
        let timeLeft = 1.0; // タイマーの残り時間

        // スタート画面を非表示にしてゲームを開始する関数
        function startGame() {
            startScreen.style.display = 'none'; // スタート画面を非表示
            gameArea.style.display = 'block'; // ゲームエリアを表示
            moveCircle(); // 円を移動
            startTimer(); // タイマーをスタート
        }

        // 円をランダムな位置に移動させる関数
        function moveCircle() {
            const maxX = gameArea.clientWidth - circle.clientWidth;
            const maxY = gameArea.clientHeight - circle.clientHeight;

            const randomX = Math.random() * maxX;
            const randomY = Math.random() * maxY;

            circle.style.left = randomX + 'px';
            circle.style.top = randomY + 'px';
        }

        // タイマーを開始する関数
        function startTimer() {
            timeLeft = 1.0; // タイマーを1.0秒にリセット
            timerDisplay.textContent = `タイマー: ${timeLeft.toFixed(2)}秒`;

            timer = setInterval(() => {
                timeLeft -= 0.01; // タイマーを0.01秒ずつ減らす
                timerDisplay.textContent = `タイマー: ${timeLeft.toFixed(2)}秒`;

                if (timeLeft <= 0) {
                    gameOver(); // ゲームオーバー処理を呼び出す
                }
            }, 10); // 10ミリ秒ごとに更新
        }

        // 円がクリックされたときの処理
        circle.addEventListener('click', function(event) {
            const circleRect = circle.getBoundingClientRect();
            const clickX = event.clientX;
            const clickY = event.clientY;

            // 円の中心を計算
            const centerX = circleRect.left + circleRect.width / 2;
            const centerY = circleRect.top + circleRect.height / 2;

            // 中心からの距離を計算
            const distance = Math.sqrt((clickX - centerX) ** 2 + (clickY - centerY) ** 2);

            if (distance <= circleRect.width / 2) { // 円の内部をクリックした場合
                if (distance <= 15) { // 中心をクリックした場合
                    score += 2; // スコアを2増加
                } else {
                    score += 1; // スコアを1増加
                }
                scoreDisplay.textContent = 'スコア: ' + score; // スコアを更新
                moveCircle(); // 円を移動

                // タイマーの更新
                clearInterval(timer); // 現在のタイマーをクリア
                const newTime = Math.max(1.0 - (Math.floor(score / 20) * 0.15), 0.1); // スコアに応じて時間を調整
                timeLeft = newTime; // 新しいタイマーの残り時間を設定
                startTimer(); // タイマーを再スタート
                event.stopPropagation(); // イベントのバブリングを防止
            }
        });

        // ゲームエリアがクリックされたときの処理
        gameArea.addEventListener('click', function(event) {
            // 円の外をクリックした場合
            if (event.target !== circle) {
                gameOver(); // ゲームオーバーを呼び出す
            }
        });

        // ゲームオーバー処理
        function gameOver() {
            clearInterval(timer); // タイマーをクリア
            gameOverDisplay.style.display = 'block'; // ゲームオーバーメッセージを表示
            continueButton.style.display = 'block'; // コンティニューボタンを表示
            finalScoreDisplay.style.display = 'block'; // 最終スコアを表示
            finalScoreDisplay.textContent = '最終スコア: ' + score; // 最終スコアを更新
            circle.style.display = 'none'; // 円を非表示にする
            score = 0; // スコアをリセット
            scoreDisplay.textContent = 'スコア: ' + score; // スコアを更新
            timerDisplay.textContent = 'タイマー: 1.00秒'; // タイマーをリセット
        }

        // コンティニュー処理
        function continueGame() {
            location.reload(); // ページをリロード
        }

        // スペースキーを押したときの処理
        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space') {
                if (gameOverDisplay.style.display === 'block') {
                    continueGame(); // ゲームオーバー時はコンティニュー
                } else {
                    startGame(); // ゲームをスタート
                }
            }
        });
    </script>
</body>
</html>
